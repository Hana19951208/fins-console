<template>
  <div>
    <el-dialog
      :close-on-click-modal="false"
      :visible.sync="show"
      @closed="closed"
      center
      title="查看客户反馈"
      width="50%"
    >
      <el-form :model="form" label-width="120px" ref="form">
        <el-row>
          <el-col :span="2">内容:</el-col>
          <el-col :span="22">
            <textarea
              readonly
              style="resize: none; padding: 10px; width: 100%; height: 200px"
              v-model="form.contents"
            />
          </el-col>
        </el-row>
        <el-row class="mt-2">
          <el-col :span="2">图片:</el-col>
          <el-col :span="22" class="feekImg">
            <el-image
              :key="index"
              :preview-src-list="[item.descn]"
              :src="item.descn"
              v-for="(item, index) in form.imgUrl"
            ></el-image>
          </el-col>
        </el-row>
      </el-form>
    </el-dialog>
  </div>
</template>
<script>
export default {
  name: "Detial",
  components: {},
  props: {
    value: {
      default: false,
      type: Boolean,
    },
    selection: {
      default: null,
      type: Number,
    },
  },
  data() {
    return {
      show: false,
      imgUrl: "",
      content: "",
      form: {
        id: null,
        contents: "",
        imgUrl: [],
      },
      options: [],
    };
  },
  watch: {
    value(value) {
      this.show = value;
      if (this.selection && this.show) {
        this.$nextTick(() => {
          console.log(55555);
          this.initData(this.selection);
        });
      }
    },
  },
  mounted() {},
  methods: {
    initData(selectionId) {
      console.log(111);
      this.$api.feedback
        .getHelpFeedbackById({ id: selectionId })
        .then((res) => {
          console.log("res222==" + JSON.stringify(res));
          if (res.respData.code === "00000000") {
            let data = res.body;
            let files = [];
            if (data[0].descn) {
              let result = data[0].descn.split(",");
              for (let i = 0; i < result.length; i++) {
                files.push({
                  descn: result[i],
                });
              }
            }
            this.form.contents = data[0].contents;
            this.form.imgUrl = files;
            console.log(2333, this.form.imgUrl);
          }
        });
    },
    clean() {
      this.$refs.form.resetFields();
    },
    dialogShowChg() {
      this.$emit("show");
    },
    closed() {
      this.dialogShowChg();
      this.$refs.form.resetFields();
    },
  },
};
</script>

<style lang="scss" scoped>
.feekImg {
  .el-image {
    display: inline-block;
    width: 22%;
    margin: 10px 1%;
    height: 55px;
  }
  /deep/ .el-image-viewer__wrapper {
    /deep/ .el-image-viewer__close {
      background-color: #ffffff;
    }
  }
}
</style>
